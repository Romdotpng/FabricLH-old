package lavahack.client.features.module.modules.exploit

import lavahack.client.features.module.Module
import lavahack.client.utils.client.interfaces.impl.tickListener
import net.minecraft.util.math.BlockPos
import net.minecraft.util.math.Direction
import net.minecraft.util.math.Vec3d
import kotlin.math.abs

/**
 * @author _kisman_
 * @since 8:33 of 17.07.2023
 */
@Suppress("PrivatePropertyName")
@Module.Info(
    name = "HitboxDesync",
    description = "mio?",
    category = Module.Category.EXPLOIT
)
class HitboxDesync : Module() {
    private val MAGIC_OFFSET = 0.200009968835369999878673424677777777777761

    init {
        fun merge(
            vec : Vec3d,
            facing : Direction
        ) = vec.multiply(abs(facing.unitVector.x).toDouble(), abs(facing.unitVector.y).toDouble(), abs(facing.unitVector.z).toDouble())

        tickListener {
            if(mc.player == null || mc.world == null) {
                return@tickListener
            }

            val facing = mc.player!!.horizontalFacing
            val box = mc.player!!.boundingBox
            val center = box.center
            val offset = Vec3d(facing.unitVector)
            val fin = merge(Vec3d.of(BlockPos.ofFloored(center)).add(0.5, 0.0, 0.5).add(offset.multiply(MAGIC_OFFSET)), facing)

            mc.player!!.setPosition(if(fin.x == 0.0) mc.player!!.x else fin.x, mc.player!!.y, if(fin.z == 0.0) mc.player!!.z else fin.z)

            toggle(false)
        }
    }
}